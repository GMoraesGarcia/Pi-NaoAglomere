create database staticdb;
use staticdb;

CREATE TABLE Empresa (
ID_empresa int not null PRIMARY KEY auto_increment,
Nome_Empresa varchar(30) not null,
CNPJ varchar(18) not null Unique,
Email varchar(50) not null,
Descricao varchar(100) not null,
Telefone varchar(15) not null,
Senha varchar(20),
QTD_Max int not null,
Rua varchar(30) not null,
Bairro varchar(20),
Numero int not null,
Regras varchar(500) not null,
Tipo_Cadastro varchar(8)
);

CREATE TABLE HorariosDisponiveis(
id INT NOT NULL AUTO_INCREMENT,
id_empresa INT NOT NULL,
horario time,
PRIMARY KEY (id),
FOREIGN KEY (id_empresa) REFERENCES  empresa (ID_empresa)
);

CREATE TABLE agendamento (
    num_agendamento  INT NOT NULL auto_increment,
    email 			 VARCHAR(50),
    usuario_id       int NOT NULL,
    telefone 		 VARCHAR(20),
    empresa_id       INT NOT NULL,
    data_Agend        DATE NOT NULL,
    horario          time NOT NULL,
    PRIMARY KEY ( num_agendamento ),
    FOREIGN KEY (usuario_id) REFERENCES usuario (id),										
    FOREIGN KEY (empresa_id ) REFERENCES Empresa (ID_empresa)
	
);

CREATE TABLE usuario (
    id               int NOT NULL auto_increment,
    nome             VARCHAR(30) NOT NULL,
    cpf              VARCHAR(11) NOT NULL,
    email            VARCHAR(50) NOT NULL,
    data_nascimento  DATE NOT NULL,
    telefone         VARCHAR(14) NOT NULL,
    senha            VARCHAR(20) NOT NULL,
    tipo_cadastro    varchar(20) NOT NULL,
     PRIMARY KEY ( id ),
     UNIQUE(cpf)
);


############ VIEWS ########
CREATE VIEW Agend_Empresa as
select ep.Nome_Empresa,us.nome,ag.data_Agend,ag.horario from agendamento as ag
INNER JOIN empresa as ep on  ag.empresa_id = ep.ID_empresa
INNER JOIN usuario as us on ag.usuario_id = us.id
ORDER BY ag.data_Agend;

CREATE VIEW Agend_User as
SELECT u.nome,e.nome_empresa,ag.data_agend,ag.horario FROM agendamento as ag
INNER JOIN usuario as u on ag.usuario_id = u.id
INNER JOIN empresa as e on ag.empresa_id = e.ID_empresa
where u.email  = 'g.moraes.garcia@gmail.com'
ORDER BY ag.data_Agend;
